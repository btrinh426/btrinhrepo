<!DOCTYPE html>
<html lang="en">

<head>
    <!-- #region Sabio Code - You can Fold this region to remove it from sight -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png">
    <link rel="shortcut icon" href="https://sabio.la/Sabio.png">
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />
    <!-- Do Not Change the HTML title or anything between this line and the line with the 💘's -->
    <title>Friends</title>
    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />
    <script src="https://pw.sabio.la/api/js/site"></script>
    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>
    <script src="/cohort93/services/friendsService.js"></script>
    <script src="/cohort93/services/usersService.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <!-- #endregion -->
    <!-- I 💘 Code, You 💘 Code, We all 💘 Code -->

    <!-- 💡 All your CSS in here -->
    <style>

    </style>
</head>

<body class="sabio" data-ins="pw-00">
    <!-- Do Not Edit or Remove this nav element -->
    <nav class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio"></nav>

    <!-- Nav Bar Elements: home people blogs tech companies jobs events -->
    <div class="container-fluid" id="nav-bar">
        <div class="row">
            <div class="p-3"><a href="/cohort93/home.html"><img id="user-img" style="height:50px;"
                        src="/cohort93/images/planet-express-logo.png"></a></div>
            <div class="col p-3">
                <nav class="home">
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/friends/friends.html">Friends</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/blogs/blogs.html">Blogs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/tecco/tech-companies.html">Tech Companies</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/jobs/jobs.html">Jobs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/events/events.html">Events</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cohort93/users/users-register.html">Register User</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="p-3">
                <span id="welcome-msg">Welcome User</span>
                <button type="button" class="btn btn-sm btn-link" id="logout-user">Logout</button>
            </div>
        </div>
    </div>

    <!-- <div class="container ajax sabio"></div> -->

    <!-- Add Friend Form -->
    <p></p>
    <div class="container" id="top">
        <form id="friend-form">
            <div class="form-row">
                <div class="col">
                    <h2><strong>Edit Friend</strong></h2>
                    <div class="form-group">
                        <label for="title-input">Title</label>
                        <input type="text" class="form-control" id="title-input" placeholder="Title">
                        <input type="hidden" class="form-control" id="id-input">
                    </div>
                    <div class="form-group">
                        <label for="bio-input">Bio</label>
                        <textarea class="form-control" rows="3" id="bio-input"
                            placeholder="Why are you the way you are?"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="summary-input">Summary</label>
                        <input type="text" class="form-control" id="summary-input" placeholder="Sum it up for us">
                    </div>
                    <div class="form-group">
                        <label for="headline-input">Headline</label>
                        <input type="text" class="form-control" id="headline-input" placeholder="Sum it up for us">
                    </div>
                    <div class="form-group">
                        <label for="slug-input">Slug</label>
                        <input type="text" class="form-control" id="slug-input" placeholder="You got a slug?">
                    </div>
                    <div class="form-group">
                        <label for="status-input">Status</label>
                        <input type="text" class="form-control" id="status-input" placeholder="That Status Update">
                    </div>
                    <div class="form-group">
                        <label for="skills-input">Skills</label>
                        <input type="text" class="form-control" id="skills-input"
                            placeholder="What skills pay those bills?">
                    </div>
                    <div class="form-group">
                        <label for="primary-image-input">Primary Image</label>
                        <input type="text" class="form-control" id="primary-image-input" placeholder="">
                    </div>
                    <!-- <div class="form-group">
                        <label for="exampleFormControlFile1">Example file input</label>
                        <input type="file" class="form-control-file" id="exampleFormControlFile1">
                    </div> -->
                    <button type="submit" class="btn btn-primary" id="submit-friend">Submit</button>
                    <button type="reset" class="btn btn-primary" id="cancel-submit-friend">Cancel</button>
                </div>
            </div>
        </form>
    </div>

    <p></p>

    <!-- Do Not Edit or Remove this footer element -->
    <footer class="do-not-remove container-fluid footer mx-auto  fb-targert sabio">
        <p class="text-center">© Sabio.la 2019</p>
    </footer>

    <!--👇🏻 All your JavaScript code goes below here inside this script tag 👇🏻 -->
    <script id="candidateCode">

        function startUp() {
            console.log("startUp is Firing");

            wireUpHandlers();

            $("#logout-user").on("click", onLogoutClicked)
            //verify if a user is signed in
            usersService.currentUser()
                .then(onCurrentUserSuccess)
                .catch(onCurrentUserError)

            var tempId = window.location.href.split("=")

            friendsService.getById(tempId[1])
                .then(onGetByIdSuccess)
                .catch(onGetByIdError)

        }

        function wireUpHandlers() {
            console.log("wireUpHandlers is Firing")

            //edit button
            $("#submit-friend").on("click", onSubmitUpdateClicked);

            //cancel add friend
            $("#cancel-submit-friend").on("click", function () {
                $("#id-input").val("")
                location.href = "friends.html"
            });
        }

        function onSubmitUpdateClicked(e) {
            e.preventDefault();
            console.log("onSubmitUpdateClicked is firing")
            //get all the form data
            var formData = getFormData();
            console.log("Retrived Form Data", formData)

            friendsService.update(formData)
                .then(onSubmitUpdateSuccess)
                .catch(onSubmitUpdateError)
        }
        function onSubmitUpdateSuccess(response) {
            console.log("onSubmitFriendSuccess is firing")
            console.log("Response and Config", response.config)
            // toastr["success"]("Socially distanced high-five engaged", " Complete")
            location.href = "friends.html"

        }
        function onSubmitUpdateError(response) {
            console.warn("Error: Well, that's disappointing.", { error: response })
        }

        function onGetByIdSuccess(responseData) {

            console.log("onGetByIdSuccess is firing")
            var tempData = responseData.data.item
            console.log("tempData", tempData)

            $("#id-input").val(tempData.id)
            $("#title-input").val(tempData.title);
            $("#bio-input").val(tempData.bio);
            $("#headline-input").val(tempData.headline);
            $("#summary-input").val(tempData.summary);
            $("#slug-input").val(tempData.slug);
            $("#status-input").val(tempData.statusID);
            $("#skills-input").val(tempData.skills);
            $("#primary-image-input").val(tempData.primaryImage.imageUrl)

        }
        function onGetByIdError(response) {
            console.log("onGetByIdError", response)
        }

        function getFormData() {
            console.log("getFormData is firing")
            var data = {};
            data.title = $("#title-input").val();
            data.bio = $("#bio-input").val();
            data.summary = $("#summary-input").val();
            data.headline = $("#headline-input").val();
            data.slug = $("#slug-input").val();
            data.statusId = 1;
            data.skills = $("#skills-input").val();
            data.primaryImage = $("#primary-image-input").val();
            data.id = $("#id-input").val()

            console.log(data)

            return data;
        }

        //user related info

        function onLogoutClicked(e) {
            usersService.logout()
                .then(onLogoutUserSuccess)
                .catch(onLogoutUserError)
        }
        function onLogoutUserSuccess(response) {
            toastr["success"]("You will now be redirected...", "Logout Successful")
            location.href = "/cohort93/users/users-login.html"
        }
        function onLogoutUserError(response) {
            console.log("Ruh-roh! Something went wrong!", response)
        }

        function onCurrentUserSuccess(response) {
            console.log("onCurrentUserSuccess is firing")
            var tempId = response.data.item.id
            console.log(tempId)

            //get user info by ID
            usersService.getById(tempId)
                .then(onGetByIdSuccess)
                .catch(onGetByIdError)

        }
        function onCurrentUserError(response) {
            console.log("onCurrentUserError is firing")
            location.href = "/cohort93/users/users.login.html"
        }

        function onGetByIdSuccess(response) {
            console.log("onGetByIdSuccess is firing")
            var tempUser = response.data.item
            console.log(tempUser)
            //jquery to insert name and picture
            $("#welcome-msg").text(`Welcome, ${tempUser.firstName}`);
            $("#user-img").attr("src", tempUser.avatarUrl)
        }
        function onGetByIdError(response) {
            console.log("onGetByIdError is firing", response)
        }
    </script>
    <!-- 🛑 Do Not Write Any Code Below here -->
</body>

</html>